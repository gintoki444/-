<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #E0C3FC 0%, #8EC5FC 100%);
      min-height: 100%;
      overflow-x: hidden;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    #app {
      display: flex;
      height: 100%;
      width: 100%;
    }

    /* Login Page */
    .login-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #E0C3FC 0%, #8EC5FC 100%);
    }

    .login-box {
      background: white;
      border-radius: 30px;
      padding: 50px 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      width: 90%;
      max-width: 420px;
      animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .login-logo {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .login-title {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
    }

    .login-subtitle {
      font-size: 14px;
      color: #718096;
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .input-group {
      position: relative;
    }

    .input-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      color: #a0aec0;
    }

    .login-input {
      width: 100%;
      padding: 15px 15px 15px 50px;
      border-radius: 15px;
      border: 2px solid #e2e8f0;
      font-size: 15px;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .login-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .login-button {
      padding: 15px;
      border-radius: 15px;
      border: none;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .login-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .login-button:active {
      transform: translateY(0);
    }

    .register-link {
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
      color: #718096;
    }

    .register-link a {
      color: #667eea;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
    }

    .register-link a:hover {
      text-decoration: underline;
    }

    .main-app {
      display: none;
      width: 100%;
      height: 100%;
    }

    .main-app.show {
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
      padding: 30px 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .app-header {
      margin-bottom: 30px;
      text-align: center;
    }

    .app-title {
      font-size: 22px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .menu-item {
      padding: 14px 20px;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 15px;
      font-weight: 500;
      color: #4a5568;
      transition: all 0.3s ease;
      background: transparent;
    }

    .menu-item:hover {
      background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
      transform: translateX(5px);
    }

    .menu-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .menu-icon {
      font-size: 22px;
      width: 28px;
      text-align: center;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      width: 100%;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .page-title {
      font-size: 32px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    .stat-icon {
      font-size: 40px;
      margin-bottom: 12px;
    }

    .stat-label {
      font-size: 14px;
      color: #718096;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #2d3748;
    }

    /* Chart Container */
    .chart-container {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .chart-title {
      font-size: 20px;
      font-weight: 600;
      color: #2d3748;
    }

    .chart-filters {
      display: flex;
      gap: 8px;
    }

    .filter-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      background: white;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #4a5568;
      transition: all 0.2s ease;
    }

    .filter-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
    }

    /* Table */
    .table-container {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow-x: auto;
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .search-box {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .search-input {
      padding: 10px 15px;
      border-radius: 10px;
      border: 2px solid #e2e8f0;
      font-size: 14px;
      width: 200px;
      transition: all 0.2s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f7fafc;
      color: #4a5568;
      border: 2px solid #e2e8f0;
    }

    .btn-secondary:hover {
      background: #edf2f7;
    }

    .btn-danger {
      background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
      color: white;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: #f7fafc;
      padding: 14px;
      text-align: left;
      font-weight: 600;
      color: #2d3748;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    td {
      padding: 14px;
      border-bottom: 1px solid #e2e8f0;
      font-size: 14px;
      color: #4a5568;
    }

    tr:hover {
      background: #f8f9ff;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .modal-header {
      font-size: 22px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border-radius: 10px;
      border: 2px solid #e2e8f0;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: #667eea;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 25px;
    }

    /* Loading Overlay */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .loading-overlay.show {
      display: flex;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid #e2e8f0;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Leaderboard */
    .leaderboard-item {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .leaderboard-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .rank {
      font-size: 32px;
      font-weight: 700;
      color: #cbd5e0;
      min-width: 60px;
      text-align: center;
    }

    .rank.top {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .student-info {
      flex: 1;
    }

    .student-name {
      font-size: 18px;
      font-weight: 600;
      color: #2d3748;
    }

    .student-id {
      font-size: 13px;
      color: #718096;
    }

    .amount {
      font-size: 24px;
      font-weight: 700;
      color: #48bb78;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 80px;
        padding: 20px 10px;
      }

      .menu-text {
        display: none;
      }

      .app-title {
        font-size: 0;
      }

      .app-title::before {
        content: "üí∞";
        font-size: 32px;
      }

      .main-content {
        padding: 20px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="app"><!-- Login Page -->
   <div class="login-container" id="loginPage">
    <div class="login-box">
     <div class="login-header">
      <div class="login-logo">
       üí∞
      </div>
      <div class="login-title">
       ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
      </div>
      <div class="login-subtitle">
       ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
      </div>
     </div>
     <form class="login-form" id="loginForm" onsubmit="handleLogin(event)">
      <div class="input-group"><span class="input-icon">üë§</span> <input type="text" class="login-input" id="loginUsername" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
      </div>
      <div class="input-group"><span class="input-icon">üîí</span> <input type="password" class="login-input" id="loginPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
      </div><button type="submit" class="login-button">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö üöÄ</button>
     </form>
     <div class="register-link">
      ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a onclick="showRegisterForm()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
     </div>
    </div>
   </div><!-- Register Page -->
   <div class="login-container" id="registerPage" style="display: none;">
    <div class="login-box">
     <div class="login-header">
      <div class="login-logo">
       üìù
      </div>
      <div class="login-title">
       ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
      </div>
      <div class="login-subtitle">
       ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
      </div>
     </div>
     <form class="login-form" id="registerForm" onsubmit="handleRegister(event)">
      <div class="input-group"><span class="input-icon">üë§</span> <input type="text" class="login-input" id="registerUsername" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
      </div>
      <div class="input-group"><span class="input-icon">‚úâÔ∏è</span> <input type="email" class="login-input" id="registerEmail" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required>
      </div>
      <div class="input-group"><span class="input-icon">üîí</span> <input type="password" class="login-input" id="registerPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required minlength="6">
      </div>
      <div class="input-group"><span class="input-icon">üîí</span> <input type="password" class="login-input" id="registerConfirmPassword" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required minlength="6">
      </div><button type="submit" class="login-button">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‚ú®</button>
     </form>
     <div class="register-link">
      ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? <a onclick="showLoginForm()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
     </div>
    </div>
   </div><!-- Main App -->
   <div class="main-app" id="mainApp"><!-- Sidebar -->
    <div class="sidebar">
     <div class="app-header">
      <div class="app-title" id="appTitle">
       ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
      </div>
     </div>
     <div class="menu-item active" data-page="dashboard"><span class="menu-icon">ÔøΩÔøΩÔøΩÔøΩ</span> <span class="menu-text" id="menuDashboard">Dashboard</span>
     </div>
     <div class="menu-item" data-page="transactions"><span class="menu-icon">üí∞</span> <span class="menu-text" id="menuTransactions">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å-‡∏ñ‡∏≠‡∏ô</span>
     </div>
     <div class="menu-item" data-page="students"><span class="menu-icon">üë•</span> <span class="menu-text" id="menuStudents">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
     </div>
     <div class="menu-item" data-page="reports"><span class="menu-icon">üìä</span> <span class="menu-text" id="menuReports">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
     </div>
     <div class="menu-item" data-page="leaderboard"><span class="menu-icon">üèÜ</span> <span class="menu-text" id="menuLeaderboard">‡∏•‡∏µ‡∏î‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î</span>
     </div>
     <div class="menu-item" data-page="settings"><span class="menu-icon">‚öôÔ∏è</span> <span class="menu-text" id="menuSettings">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
     </div>
     <div style="margin-top: auto; padding-top: 20px; border-top: 2px solid #e2e8f0;">
      <div class="menu-item" onclick="logout()" style="color: #f56565;"><span class="menu-icon">üö™</span> <span class="menu-text">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
      </div>
     </div>
    </div><!-- Main Content -->
    <div class="main-content"><!-- Dashboard Page -->
     <div class="page active" id="dashboard">
      <div class="page-title">
       üìä Dashboard
      </div>
      <div class="stats-grid">
       <div class="stat-card">
        <div class="stat-icon">
         üíµ
        </div>
        <div class="stat-label">
         ‡∏¢‡∏≠ÔøΩÔøΩ‡∏ù‡∏≤‡∏Å‡∏£‡∏ß‡∏°
        </div>
        <div class="stat-value" id="totalDeposit">
         ‡∏ø0
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon">
         üí≥
        </div>
        <div class="stat-label">
         ‡∏¢‡∏≠‡∏î‡∏ñ‡∏≠‡∏ô‡∏£‡∏ß‡∏°
        </div>
        <div class="stat-value" id="totalWithdraw">
         ‡∏ø0
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon">
         üí∞
        </div>
        <div class="stat-label">
         ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™ÔøΩÔøΩ‡∏ó‡∏ò‡∏¥
        </div>
        <div class="stat-value" id="totalBalance">
         ‡∏ø0
        </div>
       </div>
      </div>
      <div class="chart-container">
       <div class="chart-header">
        <div class="chart-title">
         ‡∏Å‡∏£‡∏≤‡∏ü‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°
        </div>
        <div class="chart-filters"><button class="filter-btn active" data-period="day">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button> <button class="filter-btn" data-period="week">‡∏£‡∏≤‡∏¢ÔøΩÔøΩ‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button> <button class="filter-btn" data-period="month">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button> <button class="filter-btn" data-period="year">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</button>
        </div>
       </div>
       <canvas id="transactionChart"></canvas>
      </div>
     </div><!-- Transactions Page -->
     <div class="page" id="transactions">
      <div class="page-title">
       üí∞ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å-‡∏ñ‡∏≠‡∏ô
      </div>
      <div class="table-container">
       <div class="table-header">
        <div class="search-box"><input type="date" class="search-input" id="filterDate" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"> <input type="text" class="search-input" id="filterStudent" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...">
        </div><button class="btn btn-primary" onclick="openAddModal()"> ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉÔøΩÔøΩÔøΩ‡∏°‡πà </button>
       </div>
       <table>
        <thead>
         <tr>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡∏ù‡∏≤‡∏Å</th>
          <th>‡∏ñ‡∏≠‡∏ô</th>
          <th>ÔøΩÔøΩ‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
         </tr>
        </thead>
        <tbody id="transactionTableBody">
         <tr>
          <td colspan="6" style="text-align: center; color: #a0aec0;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div><!-- Students Page -->
     <div class="page" id="students">
      <div class="page-title">
       üë• ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
      </div>
      <div class="table-container">
       <div class="table-header">
        <div class="search-box"><input type="text" class="search-input" id="filterStudentName" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠..."> <input type="text" class="search-input" id="filterStudentId" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™...">
        </div><button class="btn btn-primary" onclick="openAddStudentModal()"> ‚ûï ÔøΩÔøΩÔøΩ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà </button>
       </div>
       <table>
        <thead>
         <tr>
          <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
          <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th>‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
         </tr>
        </thead>
        <tbody id="studentTableBody">
         <tr>
          <td colspan="5" style="text-align: center; color: #a0aec0;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div><!-- Reports Page -->
     <div class="page" id="reports">
      <div class="page-title">
       üìÖ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
      </div>
      <div class="chart-container">
       <div class="form-group"><label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label> <input type="date" class="form-control" id="reportDate">
       </div><button class="btn btn-primary" onclick="generateReport()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
       <div id="reportResult" style="margin-top: 30px; display: none;">
        <div class="stats-grid">
         <div class="stat-card">
          <div class="stat-icon">
           üíµ
          </div>
          <div class="stat-label">
           ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
          </div>
          <div class="stat-value" id="reportDeposit">
           ‡∏ø0
          </div>
         </div>
         <div class="stat-card">
          <div class="stat-icon">
           ÔøΩÔøΩÔøΩ
          </div>
          <div class="stat-label">
           ‡∏¢‡∏≠‡∏î‡∏ñ‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
          </div>
          <div class="stat-value" id="reportWithdraw">
           ‡∏ø0
          </div>
         </div>
         <div class="stat-card">
          <div class="stat-icon">
           üí∞
          </div>
          <div class="stat-label">
           ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
          </div>
          <div class="stat-value" id="reportBalance">
           ‡∏ø0
          </div>
         </div>
        </div>
        <div style="margin-top: 20px;">
         <h3 style="margin-bottom: 15px; color: #2d3748;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</h3>
         <table>
          <thead>
           <tr>
            <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
            <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
            <th>‡∏ù‡∏≤‡∏Å</th>
            <th>‡∏ñ‡∏≠‡∏ô</th>
           </tr>
          </thead>
          <tbody id="reportTableBody"></tbody>
         </table>
        </div>
       </div>
      </div>
     </div><!-- Leaderboard Page -->
     <div class="page" id="leaderboard">
      <div class="page-title">
       üèÜ ‡∏•‡∏µ‡∏î‡πÄ‡∏î‡∏≠ÔøΩÔøΩ‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
      </div>
      <div class="chart-container">
       <div class="chart-title" style="margin-bottom: 20px;">
        ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ù‡∏≤‡∏ÅÔøΩÔøΩÔøΩ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
       </div>
       <div id="leaderboardList"></div>
      </div>
     </div><!-- Settings Page -->
     <div class="page" id="settings">
      <div class="page-title">
       ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
      </div>
      <div class="chart-container">
       <div class="form-group"><label class="form-label">Google Apps Script API URL</label> <input type="text" class="form-control" id="apiUrl" placeholder="https://script.google.com/macros/s/AKfycbzo0gFeW7Oro_SxnP5Bw_WSDtNrnr6VNXdKSgRspa7R/dev">
       </div><button class="btn btn-primary" onclick="saveSettings()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
       <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0;">
        <h3 style="margin-bottom: 15px; color: #2d3748;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Cache</h3><button class="btn btn-secondary" onclick="clearCache()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Cache</button>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Add/Edit Student Modal -->
  <div class="modal" id="studentModal">
   <div class="modal-content">
    <div class="modal-header" id="studentModalTitle">
     ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà
    </div>
    <div class="form-group"><label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <input type="text" class="form-control" id="modalNewStudentId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
    </div>
    <div class="form-group"><label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" class="form-control" id="modalNewStudentName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="closeStudentModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button> <button class="btn btn-primary" onclick="saveStudent()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
   </div>
  </div><!-- Add/Edit Transaction Modal -->
  <div class="modal" id="transactionModal">
   <div class="modal-content">
    <div class="modal-header" id="modalTitle">
     ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
    </div>
    <div class="form-group"><label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <select class="form-control" id="modalStudentId" onchange="updateStudentName()"> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option> </select>
    </div>
    <div class="form-group"><label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <input type="text" class="form-control" id="modalStudentName" readonly>
    </div>
    <div class="form-group"><label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label> <select class="form-control" id="modalType"> <option value="deposit">‡∏ù‡∏≤‡∏Å</option> <option value="withdraw">‡∏ñ‡∏≠‡∏ô</option> </select>
    </div>
    <div class="form-group"><label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ø)</label> <input type="number" class="form-control" id="modalAmount" min="0" step="0.01">
    </div>
    <div class="form-group"><label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label> <input type="date" class="form-control" id="modalDate">
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button> <button class="btn btn-primary" onclick="saveTransaction()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
   </div>
  </div><!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
   <div class="spinner"></div>
  </div>
  <script>
    // Configuration
    const defaultConfig = {
      app_title: "‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
      menu_dashboard: "Dashboard",
      menu_transactions: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å-‡∏ñ‡∏≠‡∏ô",
      menu_students: "‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
      menu_reports: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô",
      menu_leaderboard: "‡∏•‡∏µ‡∏î‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î",
      menu_settings: "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤"
    };

    const oldDefaultConfig = {
      app_title: "‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
      menu_dashboard: "Dashboard",
      menu_transactions: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å-‡∏ñÔøΩÔøΩ‡∏ô",
      menu_reports: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô",
      menu_leaderboard: "‡∏•‡∏µ‡∏î‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î",
      menu_settings: "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤"
    };

    let currentTransaction = null;
    let studentsData = [];
    let transactionsData = [];
    let chart = null;
    let currentUser = null;

    // Element SDK Implementation
    async function onConfigChange(config) {
      document.getElementById('appTitle').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('menuDashboard').textContent = config.menu_dashboard || defaultConfig.menu_dashboard;
      document.getElementById('menuTransactions').textContent = config.menu_transactions || defaultConfig.menu_transactions;
      document.getElementById('menuStudents').textContent = config.menu_students || defaultConfig.menu_students;
      document.getElementById('menuReports').textContent = config.menu_reports || defaultConfig.menu_reports;
      document.getElementById('menuLeaderboard').textContent = config.menu_leaderboard || defaultConfig.menu_leaderboard;
      document.getElementById('menuSettings').textContent = config.menu_settings || defaultConfig.menu_settings;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["menu_dashboard", config.menu_dashboard || defaultConfig.menu_dashboard],
          ["menu_transactions", config.menu_transactions || defaultConfig.menu_transactions],
          ["menu_students", config.menu_students || defaultConfig.menu_students],
          ["menu_reports", config.menu_reports || defaultConfig.menu_reports],
          ["menu_leaderboard", config.menu_leaderboard || defaultConfig.menu_leaderboard],
          ["menu_settings", config.menu_settings || defaultConfig.menu_settings]
        ])
      });
    }

    // API Functions
    function getApiUrl() {
      return localStorage.getItem('apiUrl') || '';
    }

    function showLoading() {
      document.getElementById('loadingOverlay').classList.add('show');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('show');
    }

    async function fetchAPI(action, params = {}) {
      const apiUrl = getApiUrl();
      if (!apiUrl) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API URL ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ÑÔøΩÔøΩ‡∏≤',
          confirmButtonColor: '#667eea'
        });
        return null;
      }

      const url = new URL(apiUrl);
      url.searchParams.append('action', action);
      Object.keys(params).forEach(key => {
        url.searchParams.append(key, params[key]);
      });

      try {
        showLoading();
        const response = await fetch(url);
        const data = await response.json();
        hideLoading();
        return data;
      } catch (error) {
        hideLoading();
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏î‡πâ',
          confirmButtonColor: '#667eea'
        });
        return null;
      }
    }

    // Cache Functions
    function getCache(key) {
      const cached = localStorage.getItem(key);
      if (cached) {
        const data = JSON.parse(cached);
        if (Date.now() - data.timestamp < 300000) {
          return data.value;
        }
      }
      return null;
    }

    function setCache(key, value) {
      localStorage.setItem(key, JSON.stringify({
        value,
        timestamp: Date.now()
      }));
    }

    function clearCache() {
      const apiUrl = localStorage.getItem('apiUrl');
      localStorage.clear();
      if (apiUrl) {
        localStorage.setItem('apiUrl', apiUrl);
      }
      Swal.fire({
        icon: 'success',
        title: '‡∏•‡πâ‡∏≤‡∏á Cache ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà',
        confirmButtonColor: '#667eea'
      });
      loadDashboard();
    }

    // Navigation
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', () => {
        const page = item.dataset.page;
        
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        item.classList.add('active');
        
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(page).classList.add('active');
        
        if (page === 'dashboard') loadDashboard();
        if (page === 'transactions') loadTransactions();
        if (page === 'students') loadStudentsPage();
        if (page === 'leaderboard') loadLeaderboard();
      });
    });

    // Dashboard Functions
    async function loadDashboard() {
      let transactions = getCache('transactions');
      
      if (!transactions) {
        const data = await fetchAPI('getAllTransactions');
        if (data && data.success) {
          transactions = data.transactions || [];
          setCache('transactions', transactions);
          transactionsData = transactions;
        } else {
          transactions = [];
        }
      }

      let totalDeposit = 0;
      let totalWithdraw = 0;

      transactions.forEach(t => {
        if (t.Type === 'deposit') totalDeposit += parseFloat(t.Amount || 0);
        if (t.Type === 'withdraw') totalWithdraw += parseFloat(t.Amount || 0);
      });

      const totalBalance = totalDeposit - totalWithdraw;

      document.getElementById('totalDeposit').textContent = '‡∏ø' + totalDeposit.toLocaleString('th-TH');
      document.getElementById('totalWithdraw').textContent = '‡∏ø' + totalWithdraw.toLocaleString('th-TH');
      document.getElementById('totalBalance').textContent = '‡∏ø' + totalBalance.toLocaleString('th-TH');

      updateChart(transactions, 'day');
    }

    function updateChart(transactions, period) {
      const ctx = document.getElementById('transactionChart').getContext('2d');
      
      const groupedData = {};
      transactions.forEach(t => {
        const date = new Date(t.Date);
        let key;
        
        if (period === 'day') {
          key = date.toLocaleDateString('th-TH');
        } else if (period === 'week') {
          const weekStart = new Date(date);
          weekStart.setDate(date.getDate() - date.getDay());
          key = weekStart.toLocaleDateString('th-TH');
        } else if (period === 'month') {
          key = date.toLocaleDateString('th-TH', { year: 'numeric', month: 'short' });
        } else {
          key = date.getFullYear().toString();
        }
        
        if (!groupedData[key]) {
          groupedData[key] = { deposit: 0, withdraw: 0 };
        }
        
        if (t.Type === 'deposit') {
          groupedData[key].deposit += parseFloat(t.Amount || 0);
        } else {
          groupedData[key].withdraw += parseFloat(t.Amount || 0);
        }
      });

      const labels = Object.keys(groupedData).slice(-10);
      const deposits = labels.map(l => groupedData[l].deposit);
      const withdraws = labels.map(l => groupedData[l].withdraw);
      const balances = labels.map(l => groupedData[l].deposit - groupedData[l].withdraw);

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: '‡∏ù‡∏≤‡∏Å',
              data: deposits,
              borderColor: '#48bb78',
              backgroundColor: 'rgba(72, 187, 120, 0.1)',
              tension: 0.4
            },
            {
              label: '‡∏ñ‡∏≠‡∏ô',
              data: withdraws,
              borderColor: '#f56565',
              backgroundColor: 'rgba(245, 101, 101, 0.1)',
              tension: 0.4
            },
            {
              label: '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
              data: balances,
              borderColor: '#667eea',
              backgroundColor: 'rgba(102, 126, 234, 0.1)',
              tension: 0.4
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const cached = getCache('transactions');
        if (cached) {
          updateChart(cached, btn.dataset.period);
        }
      });
    });

    // Transactions Functions
    async function loadTransactions() {
      let transactions = getCache('transactions');
      
      if (!transactions) {
        const data = await fetchAPI('getAllTransactions');
        if (data && data.success) {
          transactions = data.transactions || [];
          setCache('transactions', transactions);
          transactionsData = transactions;
        } else {
          transactions = [];
        }
      } else {
        transactionsData = transactions;
      }

      await loadStudents();
      renderTransactions(transactions);
    }

    async function loadStudents() {
      let students = getCache('students');
      
      if (!students) {
        const data = await fetchAPI('getStudents');
        if (data && data.success) {
          students = data.students || [];
          setCache('students', students);
          studentsData = students;
        } else {
          students = [];
        }
      } else {
        studentsData = students;
      }

      const select = document.getElementById('modalStudentId');
      select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µÔøΩÔøΩÔøΩ‡∏ô</option>';
      students.forEach(s => {
        const option = document.createElement('option');
        option.value = s.StudentID;
        option.textContent = `${s.StudentID} - ${s.StudentName}`;
        option.dataset.name = s.StudentName;
        select.appendChild(option);
      });
    }

    function renderTransactions(transactions) {
      const tbody = document.getElementById('transactionTableBody');
      
      if (transactions.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #a0aec0;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        return;
      }

      tbody.innerHTML = transactions.map(t => `
        <tr>
          <td>${new Date(t.Date).toLocaleDateString('th-TH')}</td>
          <td>${t.StudentID}</td>
          <td>${t.StudentName}</td>
          <td style="color: #48bb78; font-weight: 600;">${t.Type === 'deposit' ? '‡∏ø' + parseFloat(t.Amount).toLocaleString('th-TH') : '-'}</td>
          <td style="color: #f56565; font-weight: 600;">${t.Type === 'withdraw' ? '‡∏ø' + parseFloat(t.Amount).toLocaleString('th-TH') : '-'}</td>
          <td>
            <button class="btn btn-sm btn-secondary" onclick='editTransaction(${JSON.stringify(t)})'>‚úèÔ∏è</button>
            <button class="btn btn-sm btn-danger" onclick='deleteTransaction(${JSON.stringify(t)})'>üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    }

    document.getElementById('filterDate').addEventListener('input', filterTransactions);
    document.getElementById('filterStudent').addEventListener('input', filterTransactions);

    function filterTransactions() {
      const dateFilter = document.getElementById('filterDate').value;
      const studentFilter = document.getElementById('filterStudent').value.toLowerCase();
      
      let filtered = transactionsData;
      
      if (dateFilter) {
        filtered = filtered.filter(t => t.Date.startsWith(dateFilter));
      }
      
      if (studentFilter) {
        filtered = filtered.filter(t => 
          t.StudentID.toLowerCase().includes(studentFilter) ||
          t.StudentName.toLowerCase().includes(studentFilter)
        );
      }
      
      renderTransactions(filtered);
    }

    // Modal Functions
    function openAddModal() {
      currentTransaction = null;
      document.getElementById('modalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà';
      document.getElementById('modalStudentId').value = '';
      document.getElementById('modalStudentName').value = '';
      document.getElementById('modalType').value = 'deposit';
      document.getElementById('modalAmount').value = '';
      document.getElementById('modalDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('transactionModal').classList.add('show');
    }

    function editTransaction(transaction) {
      currentTransaction = transaction;
      document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
      document.getElementById('modalStudentId').value = transaction.StudentID;
      document.getElementById('modalStudentName').value = transaction.StudentName;
      document.getElementById('modalType').value = transaction.Type;
      document.getElementById('modalAmount').value = transaction.Amount;
      document.getElementById('modalDate').value = transaction.Date.split('T')[0];
      document.getElementById('transactionModal').classList.add('show');
    }

    function closeModal() {
      document.getElementById('transactionModal').classList.remove('show');
    }

    function updateStudentName() {
      const select = document.getElementById('modalStudentId');
      const selectedOption = select.options[select.selectedIndex];
      document.getElementById('modalStudentName').value = selectedOption.dataset.name || '';
    }

    async function saveTransaction() {
      const studentId = document.getElementById('modalStudentId').value;
      const studentName = document.getElementById('modalStudentName').value;
      const type = document.getElementById('modalType').value;
      const amount = document.getElementById('modalAmount').value;
      const date = document.getElementById('modalDate').value;

      if (!studentId || !amount || !date) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö',
          confirmButtonColor: '#667eea'
        });
        return;
      }

      const transactionData = {
        StudentID: studentId,
        StudentName: studentName,
        Type: type,
        Amount: parseFloat(amount),
        Date: date
      };

      const action = currentTransaction ? 'updateTransaction' : 'addTransaction';
      if (currentTransaction) {
        transactionData.TransactionID = currentTransaction.TransactionID;
      }

      const result = await fetchAPI(action, transactionData);

      if (result && result.success) {
        Swal.fire({
          icon: 'success',
          title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ',
          showConfirmButton: false,
          timer: 1500
        });
        closeModal();
        localStorage.removeItem('transactions');
        loadTransactions();
        loadDashboard();
      } else {
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: result?.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ',
          confirmButtonColor: '#667eea'
        });
      }
    }

    async function deleteTransaction(transaction) {
      const result = await Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
        text: `‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á ${transaction.StudentName}?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#f56565',
        cancelButtonColor: '#a0aec0',
        confirmButtonText: 'ÔøΩÔøΩ‡∏ö',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      });

      if (result.isConfirmed) {
        const deleteResult = await fetchAPI('deleteTransaction', {
          TransactionID: transaction.TransactionID
        });

        if (deleteResult && deleteResult.success) {
          Swal.fire({
            icon: 'success',
            title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            showConfirmButton: false,
            timer: 1500
          });
          localStorage.removeItem('transactions');
          loadTransactions();
          loadDashboard();
        } else {
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            confirmButtonColor: '#667eea'
          });
        }
      }
    }

    // Students Page Functions
    let currentStudent = null;
    let studentsBalanceData = [];

    async function loadStudentsPage() {
      let students = getCache('students');
      
      if (!students) {
        const data = await fetchAPI('getStudents');
        if (data && data.success) {
          students = data.students || [];
          setCache('students', students);
          studentsData = students;
        } else {
          students = [];
        }
      }

      let transactions = getCache('transactions');
      
      if (!transactions) {
        const transData = await fetchAPI('getAllTransactions');
        if (transData && transData.success) {
          transactions = transData.transactions || [];
          setCache('transactions', transactions);
        } else {
          transactions = [];
        }
      }

      const balances = {};
      transactions.forEach(t => {
        if (!balances[t.StudentID]) {
          balances[t.StudentID] = 0;
        }
        if (t.Type === 'deposit') {
          balances[t.StudentID] += parseFloat(t.Amount || 0);
        } else {
          balances[t.StudentID] -= parseFloat(t.Amount || 0);
        }
      });

      studentsBalanceData = students.map(s => ({
        ...s,
        balance: balances[s.StudentID] || 0
      }));

      renderStudents(studentsBalanceData);
    }

    function renderStudents(students) {
      const tbody = document.getElementById('studentTableBody');
      
      if (students.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #a0aec0;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        return;
      }

      tbody.innerHTML = students.map((s, index) => `
        <tr>
          <td>${index + 1}</td>
          <td>${s.StudentID}</td>
          <td>${s.StudentName}</td>
          <td style="color: ${s.balance >= 0 ? '#48bb78' : '#f56565'}; font-weight: 600;">
            ‡∏ø${s.balance.toLocaleString('th-TH')}
          </td>
          <td>
            <button class="btn btn-sm btn-secondary" onclick="viewStudentDetail('${s.StudentID}')">üëÅÔ∏è</button>
            <button class="btn btn-sm btn-secondary" onclick='editStudent(${JSON.stringify(s)})'>‚úèÔ∏è</button>
            <button class="btn btn-sm btn-danger" onclick='deleteStudent(${JSON.stringify(s)})'>üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    }

    document.getElementById('filterStudentName').addEventListener('input', filterStudentsTable);
    document.getElementById('filterStudentId').addEventListener('input', filterStudentsTable);

    function filterStudentsTable() {
      const nameFilter = document.getElementById('filterStudentName').value.toLowerCase();
      const idFilter = document.getElementById('filterStudentId').value.toLowerCase();
      
      let filtered = studentsBalanceData;
      
      if (nameFilter) {
        filtered = filtered.filter(s => s.StudentName.toLowerCase().includes(nameFilter));
      }
      
      if (idFilter) {
        filtered = filtered.filter(s => s.StudentID.toLowerCase().includes(idFilter));
      }
      
      renderStudents(filtered);
    }

    function openAddStudentModal() {
      currentStudent = null;
      document.getElementById('studentModalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà';
      document.getElementById('modalNewStudentId').value = '';
      document.getElementById('modalNewStudentName').value = '';
      document.getElementById('modalNewStudentId').disabled = false;
      document.getElementById('studentModal').classList.add('show');
    }

    function editStudent(student) {
      currentStudent = student;
      document.getElementById('studentModalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
      document.getElementById('modalNewStudentId').value = student.StudentID;
      document.getElementById('modalNewStudentName').value = student.StudentName;
      document.getElementById('modalNewStudentId').disabled = true;
      document.getElementById('studentModal').classList.add('show');
    }

    function closeStudentModal() {
      document.getElementById('studentModal').classList.remove('show');
    }

    async function saveStudent() {
      const studentId = document.getElementById('modalNewStudentId').value.trim();
      const studentName = document.getElementById('modalNewStudentName').value.trim();

      if (!studentId || !studentName) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö',
          confirmButtonColor: '#667eea'
        });
        return;
      }

      const studentData = {
        StudentID: studentId,
        StudentName: studentName
      };

      const action = currentStudent ? 'updateStudent' : 'addStudent';

      const result = await fetchAPI(action, studentData);

      if (result && result.success) {
        Swal.fire({
          icon: 'success',
          title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ',
          showConfirmButton: false,
          timer: 1500
        });
        closeStudentModal();
        localStorage.removeItem('students');
        loadStudentsPage();
        loadStudents();
      } else {
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: result?.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ',
          confirmButtonColor: '#667eea'
        });
      }
    }

    async function deleteStudent(student) {
      const result = await Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
        text: `‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${student.StudentName}?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#f56565',
        cancelButtonColor: '#a0aec0',
        confirmButtonText: '‡∏•‡∏ö',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      });

      if (result.isConfirmed) {
        const deleteResult = await fetchAPI('deleteStudent', {
          StudentID: student.StudentID
        });

        if (deleteResult && deleteResult.success) {
          Swal.fire({
            icon: 'success',
            title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            showConfirmButton: false,
            timer: 1500
          });
          localStorage.removeItem('students');
          loadStudentsPage();
          loadStudents();
        } else {
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: deleteResult?.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ',
            confirmButtonColor: '#667eea'
          });
        }
      }
    }

    async function viewStudentDetail(studentId) {
      showLoading();
      const data = await fetchAPI('getStudentBalance', { studentId });
      hideLoading();

      if (data && data.success) {
        const student = data.student || {};
        const transactions = data.transactions || [];
        
        let transactionTable = '';
        if (transactions.length > 0) {
          transactionTable = `
            <table style="width: 100%; margin-top: 20px; border-collapse: collapse;">
              <thead>
                <tr style="background: #f7fafc;">
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                  <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e2e8f0;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                </tr>
              </thead>
              <tbody>
                ${transactions.map(t => `
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">${new Date(t.Date).toLocaleDateString('th-TH')}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">${t.Type === 'deposit' ? '‡∏ø ‡∏ù‡∏≤‡∏Å' : 'üí≥ ‡∏ñ‡∏≠‡∏ô'}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: right; color: ${t.Type === 'deposit' ? '#48bb78' : '#f56565'};">
                      ‡∏ø${parseFloat(t.Amount).toLocaleString('th-TH')}
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        } else {
          transactionTable = '<p style="text-align: center; color: #a0aec0; margin-top: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</p>';
        }

        Swal.fire({
          title: `üë§ ${student.StudentName}`,
          html: `
            <div style="text-align: left;">
              <p style="font-size: 14px; color: #718096; margin-bottom: 10px;">
                ‡∏£‡∏´‡∏±‡∏™: <strong>${student.StudentID}</strong>
              </p>
              <p style="font-size: 18px; color: #2d3748; margin-bottom: 20px;">
                ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <strong style="color: ${student.Balance >= 0 ? '#48bb78' : '#f56565'};">
                  ‡∏ø${parseFloat(student.Balance || 0).toLocaleString('th-TH')}
                </strong>
              </p>
              <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 20px 0;">
              <h4 style="margin-bottom: 10px; color: #2d3748;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</h4>
              ${transactionTable}
            </div>
          `,
          width: '600px',
          confirmButtonColor: '#667eea',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
      }
    }

    // Reports Functions
    async function generateReport() {
      const date = document.getElementById('reportDate').value;
      
      if (!date) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
          confirmButtonColor: '#667eea'
        });
        return;
      }

      const data = await fetchAPI('getSummaryByDay', { date });

      if (data && data.success) {
        const summary = data.summary || {};
        
        document.getElementById('reportDeposit').textContent = '‡∏ø' + (summary.totalDeposit || 0).toLocaleString('th-TH');
        document.getElementById('reportWithdraw').textContent = '‡∏ø' + (summary.totalWithdraw || 0).toLocaleString('th-TH');
        document.getElementById('reportBalance').textContent = '‡∏ø' + ((summary.totalDeposit || 0) - (summary.totalWithdraw || 0)).toLocaleString('th-TH');

        const tbody = document.getElementById('reportTableBody');
        const transactions = data.transactions || [];
        
        if (transactions.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #a0aec0;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        } else {
          tbody.innerHTML = transactions.map(t => `
            <tr>
              <td>${new Date(t.Date).toLocaleTimeString('th-TH')}</td>
              <td>${t.StudentID}</td>
              <td>${t.StudentName}</td>
              <td style="color: #48bb78;">${t.Type === 'deposit' ? '‡∏ø' + parseFloat(t.Amount).toLocaleString('th-TH') : '-'}</td>
              <td style="color: #f56565;">${t.Type === 'withdraw' ? '‡∏ø' + parseFloat(t.Amount).toLocaleString('th-TH') : '-'}</td>
            </tr>
          `).join('');
        }

        document.getElementById('reportResult').style.display = 'block';
      }
    }

    // Leaderboard Functions
    async function loadLeaderboard() {
      let transactions = getCache('transactions');
      
      if (!transactions) {
        const data = await fetchAPI('getAllTransactions');
        if (data && data.success) {
          transactions = data.transactions || [];
          setCache('transactions', transactions);
        } else {
          transactions = [];
        }
      }

      const studentBalances = {};
      
      transactions.forEach(t => {
        if (!studentBalances[t.StudentID]) {
          studentBalances[t.StudentID] = {
            studentId: t.StudentID,
            studentName: t.StudentName,
            deposit: 0
          };
        }
        
        if (t.Type === 'deposit') {
          studentBalances[t.StudentID].deposit += parseFloat(t.Amount || 0);
        }
      });

      const leaderboard = Object.values(studentBalances)
        .sort((a, b) => b.deposit - a.deposit)
        .slice(0, 10);

      const container = document.getElementById('leaderboardList');
      
      if (leaderboard.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #a0aec0; padding: 40px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
        return;
      }

      container.innerHTML = leaderboard.map((item, index) => `
        <div class="leaderboard-item">
          <div class="rank ${index < 3 ? 'top' : ''}">#${index + 1}</div>
          <div class="student-info">
            <div class="student-name">${item.studentName}</div>
            <div class="student-id">${item.studentId}</div>
          </div>
          <div class="amount">‡∏ø${item.deposit.toLocaleString('th-TH')}</div>
        </div>
      `).join('');
    }

    // Settings Functions
    function saveSettings() {
      const apiUrl = document.getElementById('apiUrl').value;
      
      if (!apiUrl) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å API URL',
          confirmButtonColor: '#667eea'
        });
        return;
      }

      localStorage.setItem('apiUrl', apiUrl);
      
      Swal.fire({
        icon: 'success',
        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ',
        showConfirmButton: false,
        timer: 1500
      });
    }

    // Login/Register Functions
    function showLoginForm() {
      document.getElementById('registerPage').style.display = 'none';
      document.getElementById('loginPage').style.display = 'flex';
    }

    function showRegisterForm() {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('registerPage').style.display = 'flex';
    }

    async function handleLogin(event) {
      event.preventDefault();
      
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;

      if (!username || !password) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö',
          confirmButtonColor: '#667eea'
        });
        return;
      }

      const result = await fetchAPI('login', { username, password });

      if (result && result.success) {
        currentUser = result.user;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        Swal.fire({
          icon: 'success',
          title: `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${currentUser.username} üéâ`,
          showConfirmButton: false,
          timer: 1500
        });

        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('mainApp').classList.add('show');
        loadDashboard();
      } else {
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
          text: result?.message || '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
          confirmButtonColor: '#667eea'
        });
      }
    }

    async function handleRegister(event) {
      event.preventDefault();
      
      const username = document.getElementById('registerUsername').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('registerConfirmPassword').value;

      if (!username || !email || !password || !confirmPassword) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö',
          confirmButtonColor: '#667eea'
        });
        return;
      }

      if (password !== confirmPassword) {
        Swal.fire({
          icon: 'error',
          title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          confirmButtonColor: '#667eea'
        });
        return;
      }

      if (password.length < 6) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ',
          text: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£',
          confirmButtonColor: '#667eea'
        });
        return;
      }

      const result = await fetchAPI('register', { username, email, password });

      if (result && result.success) {
        Swal.fire({
          icon: 'success',
          title: '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ú®',
          text: '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß',
          confirmButtonColor: '#667eea'
        });

        document.getElementById('registerForm').reset();
        showLoginForm();
      } else {
        Swal.fire({
          icon: 'error',
          title: '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
          text: result?.message || '‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô',
          confirmButtonColor: '#667eea'
        });
      }
    }

    function logout() {
      Swal.fire({
        title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?',
        text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#667eea',
        cancelButtonColor: '#a0aec0',
        confirmButtonText: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then((result) => {
        if (result.isConfirmed) {
          currentUser = null;
          localStorage.removeItem('currentUser');
          
          document.getElementById('mainApp').classList.remove('show');
          document.getElementById('loginPage').style.display = 'flex';
          document.getElementById('loginForm').reset();
          
          Swal.fire({
            icon: 'success',
            title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            showConfirmButton: false,
            timer: 1500
          });
        }
      });
    }

    function checkAuth() {
      const savedUser = localStorage.getItem('currentUser');
      
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('mainApp').classList.add('show');
        return true;
      }
      
      return false;
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      const savedApiUrl = getApiUrl();
      if (savedApiUrl) {
        document.getElementById('apiUrl').value = savedApiUrl;
      }
      
      document.getElementById('reportDate').value = new Date().toISOString().split('T')[0];
      
      if (checkAuth()) {
        loadDashboard();
      }
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a8c641130d54b95',t:'MTc2NDg2MjcwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>